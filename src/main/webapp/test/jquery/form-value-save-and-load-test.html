<!DOCTYPE html>
<html lang="ko">
<head>
<title>Form value save and load test</title>
<meta charset="utf-8">
<link rel="stylesheet" href="/static/css/style.css"/>
<script src="/static/js/jquery-1.12.4.js"></script>
<script>
/**
 * ê²€ìƒ‰ íŒŒë¼ë¯¸í„° ì €ì¥ í•¨ìˆ˜. í˜„ì¬ ì €ì¥ ì‹œ location.pathNameì„ í‚¤ë¡œ ì €ì¥í•˜ë„ë¡ ì‘ì„±ë˜ì–´ ìˆìŒ.
 * @required jQuery 1.x ì´ìƒ
 */
 var formValueLoader = {
	/**
	 * formê°€ ë¬¸ìì—´ì´ë©´ íƒœê·¸ ì†ì„± ì¤‘ nameì˜ ê°’ê³¼ ì¼ì¹˜í•˜ëŠ” ìš”ì†Œë¥¼ ì°¾ì•„ jQuery ê°ì²´ë¡œ ë°˜í™˜í•œë‹¤. 
	 * ë¬¸ìì—´ì´ ì•„ë‹ˆê³  jQuery ê°ì²´ë©´ ê·¸ëŒ€ë¡œ ë°˜í™˜
	 * 
	 * @param {any} form form íƒœê·¸(ì…ë ¥ íƒœê·¸ë¥¼ ê°ì‹¸ëŠ” ë¶€ëª¨ íƒœê·¸)ì˜ nameì´ë‚˜ ID í˜¹ì€ jQuery ê°ì²´
	 */
	_generalizeParameter: function(form) {
		var $target;
		if (typeof form == 'string') {
			$target = (form.indexOf('#') == 0) ? $(form) : $('[name="' + form +'"]');
		} else if (typeof form == 'object' && form instanceof $) {
			$target = form;
		} else {
			throw new Error('formì€ ë¬¸ìì—´ í˜¹ì€ jQuery ê°ì²´ë§Œ ê°€ëŠ¥.');
		}
		if (!$target) {
			throw new Error('ëŒ€ìƒ formì„ ì°¾ì„ ìˆ˜ ì—†ìŒ.');
		}
		return $target;
	},
	/**
	 * sessionStorageì— ìˆëŠ” ê²€ìƒ‰ íŒŒë¼ë¯¸í„°ë¥¼ form íƒœê·¸ í•˜ìœ„ì˜ ì¸í’‹íƒœê·¸ì— í• ë‹¹
	 * 
	 * @param {any} form form íƒœê·¸(ì…ë ¥ íƒœê·¸ë¥¼ ê°ì‹¸ëŠ” ë¶€ëª¨ íƒœê·¸)ì˜ nameì´ë‚˜ ID í˜¹ì€ jQuery ê°ì²´
	 */
	load: function(form) {
		var $form = this._generalizeParameter(form);
		var item = sessionStorage.getItem(location.pathname);
		if(item){
			item = $.parseJSON(item);
			this._formWrite($form, item.formStatus, { decode: false });
		}
	},
	/**
	 * form íƒœê·¸ í•˜ìœ„ì˜ ëª¨ë“  ì¸í’‹íƒœê·¸ë¥¼ sessionStorageì— ì €ì¥
	 * 
	 * @param {any} form form íƒœê·¸(ì…ë ¥ íƒœê·¸ë¥¼ ê°ì‹¸ëŠ” ë¶€ëª¨ íƒœê·¸)ì˜ nameì´ë‚˜ ID í˜¹ì€ jQuery ê°ì²´
	 */
	save: function(form) {
		var $form = this._generalizeParameter(form);
		sessionStorage.setItem(location.pathname, JSON.stringify({
			formStatus: this._serializeObject($form)
		}));
	},
	/**
	 * ì‹¤ì œë¡œ form íƒœê·¸ì— ê°’ì„ í• ë‹¹í•˜ëŠ” í•¨ìˆ˜
	 * 
	 * @param {object} $form form íƒœê·¸(ì…ë ¥ íƒœê·¸ë¥¼ ê°ì‹¸ëŠ” ë¶€ëª¨ íƒœê·¸)ì˜ jQuery ê°ì²´
	 * @param {object} formStatus ì…ë ¥ íƒœê·¸ì˜ nameê³¼ valueë¡œ ì´ë¤„ì§„ js ê°ì²´. formì˜ ì €ì¥ ìƒíƒœë¥¼ ì˜ë¯¸í•¨.
	 * @param {object} settings ì´ í•¨ìˆ˜ì˜ ì»¤ìŠ¤í…€ ì„¤ì •
	 */
	_formWrite: function($form, formStatus, settings) {
		var base = {
			decode: true // ëª…ì‹œí•˜ì§€ ì•Šìœ¼ë©´ true
		}
		settings = $.extend(base, settings); // settingsê°€ ì§€ì •ë˜ì—ˆìœ¼ë©´ baseë¥¼ ë®ì–´ì”€.
		if ($form.length) {
			$form[0].reset(); // ë°ì´í„° ì…ë ¥ì „ ë¦¬ì…‹
		}
		for (var i in formStatus) {
			var $input = $form.find('input[name="' + i + '"]'),
				$textarea = $form.find('textarea[name="' + i + '"]'),
				$select = $form.find('select[name="' + i + '"]'),
				type = $input.attr('type');
			if ($input.length) {
				if (type == 'text' || type == 'hidden') {
					// if (input.hasClass('datetime')) {
					// 	var date = new Date(formStatus[i]),
					// 		dateFormat = input.attr('data-format');
					// 	input.eq(0).val(date.format(dateFormat));
					// } else {
					// }
					$input.eq(0).val(settings.decode ? decodeURIComponent(formStatus[i]) : formStatus[i]);
				}
				if (type == 'radio' || type == 'checkbox') {
					$input.each(function(idx, ele) {
                        var $ele = $(ele);
						if ($ele.val() == formStatus[i]) {
							$ele.prop('checked',true);
						}
					});
				}
			}
			if ($select.length) {				
				$select.find('option').each(function(idx, ele) {
                    var $ele = $(ele);
					if ($ele.val() == formStatus[i]) {
						$ele.prop('selected',true);
					}
				});
			}
			if ($textarea.length) {				
				$textarea.eq(0).val(settings.decode ? decodeURIComponent(formStatus[i]) : formStatus[i]);
			}
		}
    },
    /**
     * $element í•˜ìœ„ì˜ ì…ë ¥ íƒœê·¸ë¥¼ ì°¾ì•„ js objectë¡œ ë°˜í™˜.
     * 
     * @param {object} $form form íƒœê·¸(ì…ë ¥ íƒœê·¸ë¥¼ ê°ì‹¸ëŠ” ë¶€ëª¨ íƒœê·¸)ì˜ jQuery ê°ì²´
     */
	_serializeObject: function($form) {
		var rtn = {};
		$form.find('input, textarea, select').each(function(idx, ele) {
            var $ele = $(ele);
			var name = $ele.attr('name'),
				type = $ele.attr('type'),
				checked = $ele.prop('checked'),
				disabled = $ele.prop('disabled'),
				val = $ele.val();
			if (typeof name === 'undefined') {
				return true; // jquery each continue
			}
			if (type == 'checkbox' || type == 'radio') {
				if (checked && !disabled) {
					rtn[name] = val;
				}
			} else {
				if (!disabled) {
					rtn[name] = val;
				}
			}
		});
		return rtn;
	}
}
</script>
</head>
<body>
<div class="align-center">
	<h1>Form value save and load test</h1>
	<p>sessionStorageì— form ì…ë ¥ì„ ì €ì¥í•˜ê±°ë‚˜ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜</p>
	<form name="searchForm">
		<fieldset>
			<legend>í…ŒìŠ¤íŠ¸ìš© form</legend>
			<input type="text" name="ipt1" id="ipt1" value="ë£°ë£¨"><br>
			<select name="ipt2" id="ipt2">
				<option value="first">ì²« ë²ˆì§¸ ì˜µì…˜</option>
				<option value="second">ë‘ ë²ˆì§¸ ì˜µì…˜</option>
				<option value="">ë¹ˆ ê°’</option>
			</select><br>
			<textarea name="ipt3" id="ipt3" style="width: 500px; height: 200px;">ê³ ì–‘ì´(í•™ëª…: Felis silvestris catus)ëŠ” ì‹ìœ¡ëª© ê³ ì–‘ì´ê³¼ì— ì†í•˜ëŠ” í¬ìœ ë¥˜ ë™ë¬¼ì´ë‹¤. ì¼ë°˜ì ìœ¼ë¡œ "ê³ ì–‘ì´"ë¼ í•¨ì€ ì¸ê°„ì—ê²Œ ê¸¸ë“¤ì—¬ì§„ ì§‘ê³ ì–‘ì´(house cat ë˜ëŠ” domestic cat)ë¥¼ ë§í•œë‹¤. ë“¤ê³ ì–‘ì´(wild cat)ëŠ” ì•½ 10ë§Œ ë…„ì—ì„œ 7ë§Œ ë…„ ì „ë¶€í„° ì¡´ì¬í–ˆë‹¤. 2007ë…„ ê¸°ì¤€ìœ¼ë¡œ ìµœê·¼ì˜ ì—°êµ¬ì— ë”°ë¥´ë©´ ê¸¸ë“¤ì—¬ì§„ ê³ ì–‘ì´ì˜ ê¸°ì›ì€ ì•½ 1ë§Œ ë…„ ì „ ê·¼ë™ì§€ë°©ì—ì„œ ìŠ¤ìŠ¤ë¡œ ìˆ² ì†ì„ ë‚˜ì™€ ì‚¬ëŒë“¤ì´ ëª¨ì—¬ì‚¬ëŠ” ë§ˆì„ì— ëŒ€ë‹´í•˜ê²Œ ì •ì°©í•˜ì—¬ ê¸¸ë“¤ì—¬ì§„ 5ë§ˆë¦¬ ì •ë„ì˜ ì•„í”„ë¦¬ì¹´ë“¤ê³ ì–‘ì´(í•™ëª…: Felis lybica)ë¡œ ì¶”ì¸¡ëœë‹¤.</textarea><br>
			<label><input type="checkbox" name="ipt4" id="ipt4" value="on">checkme</label><br>
		</fieldset>
		<button type="button" onclick="fill()">ì•„ë¬´ê°’ì´ë‚˜ ì±„ìš°ê¸°</button>
		<button type="button" onclick="empty()">ì…ë ¥ë€ ë¹„ìš°ê¸°</button>
		<button type="button" onclick="formValueLoader.save('searchForm')">save</button>
		<button type="button" onclick="formValueLoader.load('searchForm')">load</button>
	</form>
<script>
function fill() {
	$('#ipt1').val('ë°°ê¼½ ë¹ ì§ˆ ì¤€ë¹„í•˜ì„¸ìš”.');
	$('#ipt2').val('second');
	$('#ipt3').val('ê°œì„±ê³µë‹¨ì˜ ë°˜ëŒ€ë§ì€ ê³ ì–‘ì´ì‹¤íŒ¨ë‹¨. ğŸ¤£');
	$('#ipt4').prop('checked', true);
}
function empty() {
	$('#ipt1').val('');
	$('#ipt2').val('');
	$('#ipt3').val('');
	$('#ipt4').prop('checked', false);
}
</script>
</div>
</body>
</html>
